# cpu高达100%原因调查经验

> 主要工具gdb, top

```cpp
思路：
    程序占用100%的cpu，程序即进程，也就是说进程占了100%的cpu（一个核）
    一个进程有多个线程，究竟是哪一个线程占了100%的cpu？
    这个线程在干什么？
   
1. 查看程序的进程号
    命令：top -c。 输入大写P，top的输出会按使用cpu多少排序。
    PID就是进程号，我程序的进程号是4918。
2. 查看耗CPU的线程号
    命令：top -Hp 进程号。 同样输入大写P，top的输出会按使用
	输入top -Hp 4918，展示内容如图：
    可以看出PID是4927的线程占到了100%的cpu，我的业务日志是打印线程号的，打开日志
3. 查看耗CPU的任务
	上面找到了耗CPU的线程，那这个线程在做什么呢？
	看线程在干什么，可以看线程的堆栈，命令是pstack 进程号，会输出所有线程的堆栈信息。
    输入pstack 4918，并搜索线程4927的堆栈，展示内容如图：

终章:
其实从堆栈信息定位问题还是有些抽象的，但是大概可以看出线程在做什么，至少给排查问题指明了方向。
```

> linux 如何查看一个进程的堆栈

```cpp

第一种：pstack 进程ID
第二种，使用gdb attach 进程ID，然后再使用命令 thread apply all bt
第三种：strace -f -p pid  该方法和pstack类似
第四中：gcore pid ，输出core文件，gdb cmd corefile
两种方法都可以列出进程所有的线程的当前的调用栈。

不过，使用gdb的方法，还可以查看某些信息，例如局部变量，指针等。
不过，如果只看调用栈的话，pstack还是很方便的。 
```



